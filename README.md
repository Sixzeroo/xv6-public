# OS project in NTUST

## ğŸ™‚ ä½¿ç”¨æƒ…å¢ƒèªªæ˜(åŒ…å«æµç¨‹åœ–)

### Lazy Allocation Memory
æ­£å¸¸æƒ…æ³ä¸‹processéƒ½æ˜¯å…ˆç”³è«‹Memoryï¼Œç„¶å¾Œå†ä½¿ç”¨ã€‚ä½†æ˜¯æœ‰ä¸€å€‹processæœ‰çš„æ™‚å€™æœƒä¸€æ¬¡æ€§ç”³è«‹éå¸¸å¤šçš„Memoryï¼Œä½†æ˜¯å¯èƒ½åˆä¸æœƒç”¨åˆ°ï¼Œæ¯”å¦‚èªªå¤šé¤˜çš„arrayç©ºé–“ã€‚

æ‰€ä»¥å°±å¯ä»¥é€²è¡Œä¸€äº›å„ªåŒ–ï¼Œç•¶processç”³è«‹çš„æ™‚å€™ä¸çµ¦å…¶åˆ†é…Memoryï¼Œç›´åˆ°å…¶ä½¿ç”¨é€™å€‹Memoryçš„æ™‚å€™æ‰allocate memory çµ¦é€™å€‹processã€‚

å¯¦ä½œLazy Allocation Memoryä¸»è¦åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼šç”³è«‹Memoryçš„æ™‚å€™ä¸å¯¦éš›åˆ†é…Memoryã€ä½¿ç”¨çš„æ™‚å€™Allocate memory

#### ç”³è«‹Memoryçš„æ™‚å€™ä¸å¯¦éš›åˆ†é…Memory

ç•¶processç”³è«‹Memoryçš„æ™‚å€™åªæ˜¯å¢åŠ processçš„Memoryå¤§å°æŒ‡æ¨™ï¼Œä½†æ˜¯ä¸çµ¦å…¶åˆ†é…å¯¦éš›çš„memoryï¼š

åŸä¾†processç”³è«‹Memoryçš„æµç¨‹ï¼š

![](https://i.imgur.com/5jxdVMq.png)

ä¿®æ”¹ä»¥å¾Œï¼Œåªå¢åŠ processçš„sizeè€Œä¸å¯¦éš›åˆ†é…Memoryï¼š

![](https://i.imgur.com/XNQG8R2.png)

#### ä½¿ç”¨çš„æ™‚å€™Allocate memory

ç•¶processçœŸæ­£éœ€è¦ä½¿ç”¨Memoryçš„æ™‚å€™å›å› ç‚ºæ‰¾ä¸åˆ°addressè€Œç™¼ç”Ÿpage faultï¼Œé€™å€‹æ™‚å€™å†allocate memoryï¼š

![](https://i.imgur.com/h3sSrqO.png)

---

### Scheduling:Multilevel feedback queue with priorit
é€šéproc.cä¸­çš„scheduleréƒ¨ä»½æˆ‘å€‘å¯ä»¥çœ‹å‡ºxv6æ¡ç”¨çš„æ˜¯Round Robinç®—æ³•ä¾†é€²è¡Œæ’ç¨‹ï¼Œç”±æ–¼é€™å€‹æ’ç¨‹æ¼”ç®—æ³•éå¸¸ç°¡å–®ï¼Œç¼ºä¹éˆæ´»æ€§ï¼Œå› æ­¤æˆ‘å€‘ä¿®æ”¹äº†scheduleréƒ¨ä»½ï¼Œå¯¦ç¾ä¸€å€‹å¸¶priorityçš„multilevel feedback queueï¼Œåœ¨æ¯å€‹éšŠåˆ—ä¸­æ¡ç”¨å„ªå…ˆç´šé«˜çš„ç¨‹åºå…ˆåŸ·è¡Œçš„ç®—æ³•ï¼Œåœ¨å„å€‹éšŠåˆ—ä¹‹é–“å„ªå…ˆç´šè¶Šä½çš„éšŠåˆ—æœ‰è¶Šå¤šçš„åŸ·è¡Œæ™‚é–“ã€‚é€™æ¨£æˆ‘å€‘å¯ä»¥å°‡ç³»çµ±ç¨‹åºçš„å„ªå…ˆç´šæé«˜ï¼Œä¹Ÿå¯ä»¥æ‰‹å‹•ä¿®æ”¹ç¨‹åºçš„priorityå¾è€ŒæŒ‡å®šæŸäº›ç¨‹åºå„ªå…ˆåŸ·è¡Œã€‚
#### åŸºæœ¬è¨­ç½®


| queue | priority | runtime |
| -------- | -------- | -------- |
| 1     | 0-4     | 1/100sec     |
|2|5-14|5sec|
|3|15-20|10sec|

#### å¢åŠ systemcallä»¥åŠç”¨æˆ¶ç¨‹åºèªªæ˜


| syscall | åŠŸèƒ½ | 
| -------- | -------- | 
| cps    | æ‰“å°processçš„nameã€pidã€stateã€priorityã€rrnumï¼ˆç›®å‰çš„é‹è¡Œæ¬¡æ•¸ï¼‰  | 
|chpr|ä¿®æ”¹ç¨‹åºçš„priority|

| ç”¨æˆ¶ç¨‹åº | åŠŸèƒ½ |
|-------|-------|
|ps|èª¿ç”¨cpsç³»çµ±èª¿ç”¨|
|mkprc|testç”¨çš„ç¨‹åºï¼Œæœƒforkï¼Œç„¶å¾Œé€²è¡Œå¾ªç’°çš„é‹ç®—ä»¥æ¶ˆè€—æ™‚é–“ï¼Œä¾¿æ–¼æ’ç¨‹ç®—æ³•çµæœé¡¯ç¤º|
|chpr|æª¢æ¸¬è¼¸å…¥priorityæ˜¯å¦åˆæ³•ï¼Œç„¶å¾Œèª¿ç”¨chprç³»çµ±èª¿ç”¨|


#### æ¼”ç®—æ³•èªªæ˜
ç¬¬ä¸€éšŠåˆ—ä¸­åŒ…å«priorityç‚º0-3çš„ç¨‹åºï¼Œç¬¬äºŒéšŠåˆ—ä¸­åŒ…å«priorityç‚º4-14çš„ç¨‹åºï¼Œç¬¬ä¸‰éšŠåˆ—ä¸­åŒ…å«priorityç‚º15-20çš„ç¨‹åºã€‚

ç¬¬ä¸€éšŠåˆ—ä¸­çš„ç¨‹åºæ¯æ¬¡åˆ†åˆ°ä¸€å€‹æ™‚é–“ç‰‡ï¼Œå³1/100secï¼Œé™¤éæ‰‹å‹•èª¿æ•´å¦å‰‡å…¶priorityä¸æœƒç™¼ç”Ÿæ”¹è®Šã€‚
ç¬¬äºŒéšŠåˆ—ä¸­çš„ç¨‹åºæ¯æ¬¡åˆ†åˆ°500ï¼ˆç‚ºäº†ä¾¿æ–¼é¡¯ç¤ºæ•ˆæœï¼Œæ­¤è™•å°‡æ•¸æ“šè¨­å®šå¾—æ¯”è¼ƒå¤§ï¼‰å€‹æ™‚é–“ç‰‡ï¼Œå³5secã€‚ç‚ºäº†é¿å…starvationï¼ŒåŸ·è¡Œ5secå¾Œè©²ç¨‹åºçš„priorityå°±æœƒ+1ï¼Œç•¶å…¶priorityé”åˆ°15ï¼Œå³é€²å…¥ç¬¬ä¸‰éšŠåˆ—ã€‚è‹¥æœ‰æ–°çš„ç¨‹åºç”¢ç”Ÿä¸”å…¶å„ªå…ˆç´šé«˜æ–¼å®ƒï¼Œå‰‡æœƒè½‰å»åŸ·è¡Œå„ªå…ˆç´šæ›´é«˜çš„ç¨‹åºã€‚
ç¬¬ä¸‰éšŠåˆ—ä¸­çš„ç¨‹åºæ¯æ¬¡åˆ†åˆ°1000å€‹æ™‚é–“ç‰‡ï¼Œå³10secã€‚æ¯åŸ·è¡Œ1000å€‹æ™‚é–“ç‰‡ï¼Œpriorityå³+1ï¼Œç›´åˆ°å…¶priorityå‡åˆ°20ç‚ºæ­¢ã€‚

å°æ–¼initå’Œshæˆ‘å€‘åˆ†é…äº†æœ€é«˜çš„å„ªå…ˆç´š0ï¼Œå…¶ä»–å¾shellä¸­åŸ·è¡Œçš„ç¨‹åºæˆ‘å€‘æœƒåˆ†é…å„ªå…ˆç´šç‚º4ï¼Œéƒ½å±¬æ–¼ç¬¬ä¸€éšŠåˆ—ï¼›å°æ–¼å…¶ä»–ç¨‹åºï¼Œåƒforkå‡ºä¾†çš„å­ç¨‹åºï¼Œé»˜èªå„ªå…ˆç´šç‚º5ã€‚

#### æµç¨‹åœ–
##### ç³»çµ±é‹è¡Œæµç¨‹åœ–
å¯¦éš›ä¸Šé‹è¡Œèµ·ä¾†ä¹‹å¾Œå°±æ˜¯åœ¨schedulerä¸­çš„swtch(&(c->scheduler),p->context)å’Œshedä¸­çš„swtch(&p->context,mucpu()->scheduler)é€™å…©è¡Œä»£ç¢¼ä¹‹é–“ä¾†å›åˆ‡æ›
![](https://i.imgur.com/z8HwZrW.png)
##### scheduleréƒ¨ä»½ï¼ŒåŸå§‹æµç¨‹åœ–![](https://i.imgur.com/NxB1Nao.png)
##### scheduleréƒ¨ä»½ï¼Œä¿®æ”¹å¾Œçš„æµç¨‹åœ–![](https://i.imgur.com/NfFs8M3.png)



## ğŸ˜‡ æˆåŠŸç•«é¢

### Lazy Allocation Memory

![](https://i.imgur.com/9zzyaMb.png)

### Scheduling:Multilevel feedback queue with priorit
#### default priority
åˆå§‹æ™‚ï¼Œå¯ä»¥çœ‹åˆ°initå’Œshçš„priorityæœ€é«˜ï¼Œå¾shellåŸ·è¡Œçš„psçš„priorityç‚º4
![](https://i.imgur.com/GSVyYDN.png)
å¾shellåŸ·è¡Œçš„mkprcé»˜èªpriorityä¹Ÿæ˜¯4ï¼Œä½†æ˜¯forkå‡ºçš„å­ç¨‹åºé»˜èªpriorityç‚º5
![](https://i.imgur.com/cO4XWv3.png)
#### ç¬¬äºŒéšŠåˆ—ï¼ˆpriorityï¼š5ï½14ï¼‰priorityå¢åŠ æƒ…æ³
å¯ä»¥çœ‹åˆ°ç•¶7ï¼ˆpidï¼‰é‹è¡Œäº†500å€‹æ™‚é–“ç‰‡å¾Œï¼Œä»–çš„å„ªå…ˆç´šå°±æœƒç”±5ä¸Šå‡åˆ°6ï¼Œæ™‚é–“ç‰‡é‡æ–°é–‹å§‹è¨ˆæ•¸
![](https://i.imgur.com/ZBdleUV.png)
#### ç¬¬ä¸‰éšŠåˆ—ï¼ˆpriorityï¼š15ï½20ï¼‰priorityå¢åŠ æƒ…æ³
åœ¨åŸ·è¡Œäº†1000å€‹æ™‚é–“ç‰‡ä¹‹å¾Œï¼Œ11çš„å„ªå…ˆç´šç”±15è®Šæˆäº†16
![](https://i.imgur.com/K4mE5Ur.png)

#### å„ªå…ˆç´šé«˜çš„processæœƒå„ªå…ˆåŸ·è¡Œ
å¯ä»¥çœ‹åˆ°ï¼Œç”±æ–¼18çš„å„ªå…ˆç´šè¼ƒ7è¦é«˜ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨åŸ·è¡Œ18ï¼Œ7çš„priority(11)å’Œrrnum(312)éƒ½æ²’æœ‰ç™¼ç”Ÿè®ŠåŒ–ï¼Œèªªæ˜å®ƒä¸¦æ²’æœ‰å¾—åˆ°åŸ·è¡Œï¼Œä¸”18æ¯åŸ·è¡Œ500å€‹æ™‚é–“ç‰‡å¾Œï¼Œ
![](https://i.imgur.com/r1kQNm7.png)

#### ä¿®æ”¹ç¨‹åºçš„å„ªå…ˆç´š
ç”¨chprç¨‹åºå°‡6çš„priorityç”±10è®Šç‚º6ï¼ˆç´…è‰²éƒ¨åˆ†ï¼‰ï¼›è—è‰²éƒ¨ä»½å¯ä»¥çœ‹åˆ°6çš„å„ªå…ˆç´šæé«˜å¾Œå°‡ä¸€ç›´åŸ·è¡Œå„ªå…ˆç´šè¼ƒé«˜çš„6ã€‚
![](https://i.imgur.com/NnPnFqm.png)

## æ›´å¤š
æ›´å¤šxv6é¡¹ç›®å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://ntust-csie-islab.github.io/106-OS-homework2-2/)
